<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>比赛信息统计</title>
	<link rel="stylesheet" href="../layui/css/layui.css" media="all" />
	<link rel="../js/echarts.min.js">	
</head>
		<script src="../js/echarts.min.js"></script>
		<style>
			p{
				float:left;
				width: 180px;
				margin: 0;
				margin-left:18px;
		    	margin-top:25px;
		    	family:"微软雅黑";
		    	font-size:20px;
		    	font-weight:bold;
		    	color:#393D49;
		    	text-align:center;
			}
		</style>
<body>

	<div style="box-shadow:0 0 20px 3px #DCDCDC;width: 96%;height:970px;float:left;margin-left:30px;margin-top:30px;">
		<div style="width: 100%;height:70px;float:left;border-bottom:1px solid #DCDCDC;">
			<p>参赛记录统计</p>
			<div id="div1_null" class="layui-form" style="margin-top:25px;padding-right:20px;float:right;">
			     <div class="layui-inline">
			        <select name="competitionid" id="competitionid" lay-verify="competitionid" lay-search=""  lay-filter="competitionid">
			          <option value="">选择或搜索赛事</option>
			        </select>
			      </div>
			      
				<div class="layui-inline">
			      <div class="layui-input-inline">
			        <input type="text" class="layui-input" id="grade3" name="grade" autocomplete="off"  placeholder="请选择年级">
			      </div>      
    			</div> 
			
				<div class="layui-inline">
			    	<input id="studentid" class="layui-input" name="studentid"  placeholder="学号"  autocomplete="off" style="height:25;width:250" type='text' value=""/>
			    	<i id="icon_close" style="color:#D3D3D3;font-size: 18px;position: absolute;top: 9px; right: 6px;cursor: pointer;" class="layui-icon layui-icon-close"></i>
		    	</div>
		    	
				<div class="layui-inline">
			    	<input id="majorname" class="layui-input" name="majorname"  placeholder="专业名称"  autocomplete="off" style="height:25;width:250" type='text' value=""/>
			    	<i id="icon_close" style="color:#D3D3D3;font-size: 18px;position: absolute;top: 9px; right: 6px;cursor: pointer;" class="layui-icon layui-icon-close"></i>
		    	</div>
		    	
				<div class="layui-inline">
			    	<input id="classname" class="layui-input" name="classname"  placeholder="班级名称"  autocomplete="off" style="height:25;width:250" type='text' value=""/>
			    	<i id="icon_close" style="color:#D3D3D3;font-size: 18px;position: absolute;top: 9px; right: 6px;cursor: pointer;" class="layui-icon layui-icon-close"></i>
		    	</div>
		    	
		    	<button id="search_btn3" class="layui-btn" lay-submit=""  data-type="reload" lay-event="search">统计</button>
			</div>
		</div>
		<div id="test_div1" style="box-shadow:0 0 10px 3px #DCDCDC;width: 600px;height:400px;float:left;margin-left:10px;margin-top:30px;"></div>
		<div id="test_div2" style="box-shadow:0 0 20px 3px #DCDCDC;width: 600px;height:400px;float:right;margin-right:10px;margin-top:30px;"></div>
		<div id="test_div3" style="box-shadow:0 0 20px 3px #DCDCDC;width: 600px;height:400px;float:left;margin-left:10px;margin-top:30px;"></div>
		<div id="test_div4" style="box-shadow:0 0 20px 3px #DCDCDC;width: 600px;height:400px;float:right;margin-right:10px;margin-top:30px;"></div>
	</div>
	
	<div id="test_div5_fu" style="box-shadow:0 0 20px 3px #DCDCDC;width:96%;height:700px;float:left;margin-top:30px;margin-right:25px;margin-left:30px;">
		<div id="test_div5_search" style="width:100%;height:99px;float:right;">
			<p>各专业奖项获得人数</p>
			<div id="div5_null" class="layui-form" style="margin-top:25px;padding-right:30px;float:right;">
			     <div class="layui-inline">
			        <select name="competitionid" id="competitionid2" lay-verify="competitionid" lay-search=""  lay-filter="competitionid">
			          <option value="">选择或搜索赛事</option>
			        </select>
			    </div>
			
				<div class="layui-inline">
			      <div class="layui-input-inline">
			        <input type="text" class="layui-input" id="grade" name="grade" autocomplete="off"  placeholder="请选择年级">
			      </div>      
    			</div>
    			<button id="search_btn" class="layui-btn" lay-submit=""  data-type="reload" lay-event="search">统计</button>
			</div>
		</div>
		<div id="test_div5" style="border-top:1px solid #DCDCDC;width:100%;height:600px;float:right"></div>
	</div>
	
	<div id="test_div6_fu" style="box-shadow:0 0 20px 3px #DCDCDC;width:96%;height:700px;float:left;margin-top:30px;margin-right:25px;margin-left:30px;">
		<div id="test_div6_search" style="width:100%;height:99px;float:right;">
			<p>各专业各级获奖人数</p>
			<div id="div6_null" class="layui-form"  style="margin-top:25px;padding-right:30px;float:right;">
			     <div class="layui-inline">
			        <select name="competitionid" id="competitionid3" lay-verify="competitionid" lay-search=""  lay-filter="competitionid">
			          <option value="">选择或搜索赛事</option>
			        </select>
			    </div>
			    
				<div class="layui-inline">
			      <div class="layui-input-inline">
			        <input type="text" class="layui-input" id="grade2" name="grade" autocomplete="off"  placeholder="请选择年级">
			      </div>      
    			</div>
    			<button id="search_btn2" class="layui-btn" lay-submit=""  data-type="reload" lay-event="search">统计</button>
			</div>
		</div>
		<div id="test_div6" style="border-top:1px solid #DCDCDC;width:100%;height:600px;float:right"></div>
	</div>
<script type="text/javascript" src="../layui/layui.js"></script>
<script type="text/javascript" src="../datas/nav.js"></script>
<script>
layui.use(['form','layer','laydate'],function(){
	var form = layui.form;
	var layer = layui.layer;
	var $ = layui.$;
	var laydate = layui.laydate;
	  laydate.render({
		    elem: '#grade'
		    ,type: 'year'
		  });
	  laydate.render({
		    elem: '#grade2'
		    ,type: 'year'
		  });
	  laydate.render({
		    elem: '#grade3'
		    ,type: 'year'
		  });
	function chushihua(myChart){
		var option = {
				title : {
			        text: '',
			        subtext: '',
			        x:'center'
			    },
			    tooltip : {
			        trigger: 'item',
			        formatter: "{a} <br/>{b} : {c} ({d}%)"
			    },
			    legend: {
			        orient: 'vertical',
			        left: 'left',
			       data:[]
			    }, 
			    series:[{
			    	name: '',
		            type: 'pie',
		            radius : '55%',
		            center: ['50%', '60%'],
	                data:[
	                    {value:0,name:''}
	                ],
	                itemStyle: {
	                    emphasis: {
	                        shadowBlur: 10,
	                        shadowOffsetX: 0,
	                        shadowColor: 'rgba(0, 0, 0, 0.5)'
	                    }
	                }
	            }]
		};
		myChart.setOption(option);
	}
	function fuzhi(myChart,competitionid,grade,studentid,majorname,classname){
		$.getJSON("../RanksNumberServlet",{
			'competitionid':competitionid,
			'grade':grade,
			'studentid':studentid,
			'majorname':majorname,
			'classname':classname
		},function(data){
            //创建一个数组，用来装对象传给series.data，因为series.data里面不能直接鞋for循环
            var servicedata=[];
            for(var i=0;i<data.length;i++){
                var obj=new Object();
                obj.name=data[i].ranks;
                obj.value=data[i].number;
                servicedata[i]=obj;
            }
            myChart.setOption({                 
            	title : {
			        text: '获奖类型人数统计',
			        subtext: '人数统计',
			        x:'center'
			    },
    		    tooltip : {
    		        trigger: 'item',
    		        formatter: "{a} <br/>{b} : {c} ({d}%)"
    		    },
    		    legend: {
    		        orient: 'vertical',
    		        left: 'left',
    		       data : servicedata
    		    }, 
    		    series:[{
    		    	name: '人数',
    	            type: 'pie',
    	            radius : '55%',
    	            center: ['50%', '60%'],
    	            data: servicedata,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]   
            });
            myChart.on('click',function(param){
            	//console.log(param.name);
            	 location.href="../record/recordinfo.html?ranks2="+param.name+"&competitionid2="+competitionid; 
            	//location.href="../FindRecordByPageServlet?currentPage=1&rows=10&ranks="+param.name;
            });
		});

	}
	function fuzhi2(myChart,competitionid,grade,studentid,classname){
		$.getJSON("../TeamgradeNumberServlet",{
			//'studentid':$("#studentid").val(),
			//'classname':$("#classname").val()
			'competitionid':competitionid,
			'grade':grade,
			'studentid':studentid,
			'classname':classname
		},function(data){
            //创建一个数组，用来装对象传给series.data，因为series.data里面不能直接鞋for循环
            var servicedata=[];
            for(var i=0;i<data.length;i++){
                var obj=new Object();
                obj.name=data[i].grade;
                obj.value=data[i].number;
                servicedata[i]=obj;
            }
            myChart.setOption({                 
            	title : {
			        text: '各年级参赛人数',
			        subtext: '人数统计',
			        x:'center'
			    },
    		    tooltip : {
    		        trigger: 'item',
    		        formatter: "{a} <br/>{b} : {c} ({d}%)"
    		    },
    		    legend: {
    		        orient: 'vertical',
    		        left: 'left',
    		       data : servicedata
    		    }, 
    		    series:[{
    		    	name: '人数',
    	            type: 'pie',
    	            radius : '55%',
    	            center: ['50%', '60%'],
    	            data: servicedata,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]   
            });
            myChart.on('click',function(param){
            	//console.log(param.name);
            	 location.href="../team/teaminfo.html?grade="+param.name; 
            });
		});

	}
	function fuzhi3(myChart,competitionid,grade,studentid,classname){
		$.getJSON("../TeamclassNumberServlet",{
			'competitionid':competitionid,
			'grade':grade,
			'studentid':studentid,
			'classname':classname
		},function(data){
            //创建一个数组，用来装对象传给series.data，因为series.data里面不能直接鞋for循环
            var servicedata=[];
            for(var i=0;i<data.length;i++){
                var obj=new Object();
                obj.name=data[i].classname;
                obj.value=data[i].number;
                servicedata[i]=obj;
            }
            myChart.setOption({                 
            	title : {
			        text: '各班级参赛人数',
			        subtext: '人数统计',
			        x:'center'
			    },
    		    tooltip : {
    		        trigger: 'item',
    		        formatter: "{a} <br/>{b} : {c} ({d}%)"
    		    },
    		    legend: {
    		        orient: 'vertical',
    		        left: 'left',
    		       data : servicedata
    		    }, 
    		    series:[{
    		    	name: '人数',
    	            type: 'pie',
    	            radius : '55%',
    	            center: ['50%', '60%'],
    	            data: servicedata,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]   
            });
            myChart.on('click',function(param){
            	//console.log(param.name);
            	 location.href="../team/teaminfo.html?classname="+param.name; 
            });
		});
	}
	function fuzhi4(myChart,competitionid,grade,studentid,majorname,classname){
		$.getJSON("../TeammajorNumberServlet",{
			'competitionid':competitionid,
			'grade':grade,
			'studentid':studentid,
			'majorname':majorname,
			'classname':classname
		},function(data){
            //创建一个数组，用来装对象传给series.data，因为series.data里面不能直接鞋for循环
            var servicedata=[];
            for(var i=0;i<data.length;i++){
                var obj=new Object();
                obj.name=data[i].majorname;
                obj.value=data[i].number;
                servicedata[i]=obj;
            }
            myChart.setOption({                 
            	title : {
			        text: '各专业参赛人数',
			        subtext: '人数统计',
			        x:'center'
			    },
    		    tooltip : {
    		        trigger: 'item',
    		        formatter: "{a} <br/>{b} : {c} ({d}%)"
    		    },
    		    legend: {
    		        orient: 'vertical',
    		        left: 'left',
    		       data : servicedata
    		    }, 
    		    series:[{
    		    	name: '人数',
    	            type: 'pie',
    	            radius : '55%',
    	            center: ['50%', '60%'],
    	            data: servicedata,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]   
            });
            myChart.on('click',function(param){
            	//console.log(param.name);
            	 location.href="../team/teaminfo.html?majorname="+param.name; 
            });
		});
	}
	  $.getJSON("../FindAllCompetitionServlet",{},function(data){
			$.each(data,function(index,item){
				$("#competitionid").append($("<option>").val(item.competitionid).text(item.competitionname));
			});
			form.render();
	  });
	  $.getJSON("../FindAllCompetitionServlet",{},function(data){
			$.each(data,function(index,item){
				$("#competitionid2").append($("<option>").val(item.competitionid).text(item.competitionname));
			});
			form.render();
	  });
	  $.getJSON("../FindAllCompetitionServlet",{},function(data){
			$.each(data,function(index,item){
				$("#competitionid3").append($("<option>").val(item.competitionid).text(item.competitionname));
			});
			form.render();
	  });
	 var competitionid = document.getElementById("competitionid").value;
	 var grade3 = document.getElementById("grade3").value;
	 var studentid = document.getElementById("studentid").value;
	 var majorname = document.getElementById("majorname").value;
	 var classname = document.getElementById("classname").value;
	 var active3={
		  		reload:function(){
		  			 var competitionid = document.getElementById("competitionid").value;
		  			 var grade3 = document.getElementById("grade3").value;
		  			 var studentid = document.getElementById("studentid").value;
		  			 var majorname = document.getElementById("majorname").value;
		  			 var classname = document.getElementById("classname").value;
		  			fuzhi(myChart,competitionid,grade3,studentid,majorname,classname);
		  			fuzhi2(myChart2,competitionid,grade3,studentid,classname);
		  			fuzhi3(myChart3,competitionid,grade3,studentid,classname);
		  			fuzhi4(myChart4,competitionid,grade3,studentid,majorname,classname);
		  		    }  
		    };
			  
	  $('#search_btn3').on('click', function(){
		                  var type = 'reload';
		                  active3[type] ? active3[type].call(this) : '';
		                });
	// 柱状图 
	var dataArray = ['product','一等奖','二等奖', '三等奖', '特等奖', '优秀奖'];
	function chushihua2(myChart){
		var option = {
				legend: {},
		        tooltip: {},
		        dataset:{
		        	 source: [
		                  dataArray,
		                 ['人工智能',43.3,85.8,93.7, 1, 23],
		                 ['物联网工程',83.1,73.4, 55.1, 123, 34],
		                 ['软件工程', 86.4, 65.2, 82.5, 90, 76],
		                 ['网络工程',72.4, 53.9, 39.1, 50, 60],
		                 ['计算机科学与技术', 72.4, 53.9, 39.1, 50, 60] 
		             ]
		        },
		        xAxis: {type: 'category'},
		        yAxis: {},
		        series: [
		            {type: 'bar'},
		            {type: 'bar'},
		            {type: 'bar'},
		            {type: 'bar'},
		            {type: 'bar'}
		        ]
		};
		myChart.setOption(option);
	}
	var dataArray2 = ['product','国家级','省级', '市级', '校级', '院级'];
	function chushihua3(myChart){
		var option = {
				legend: {},
		        tooltip: {},
		        dataset:{
		        	 source: [
		                  dataArray2,
		                 ['人工智能',43.3,85.8,93.7, 1, 23],
		                 ['物联网工程',83.1,73.4, 55.1, 123, 34],
		                 ['软件工程', 86.4, 65.2, 82.5, 90, 76],
		                 ['网络工程',72.4, 53.9, 39.1, 50, 60],
		                 ['计算机科学与技术', 72.4, 53.9, 39.1, 50, 60] 
		             ]
		        },
		        xAxis: {type: 'category'},
		        yAxis: {},
		        series: [
		            {type: 'bar'},
		            {type: 'bar'},
		            {type: 'bar'},
		            {type: 'bar'},
		            {type: 'bar'}
		        ]
		};
		myChart.setOption(option);
	}
	function fuzhi5(myChart,competitionid,grade){
		$.getJSON("../WinnerMajorGradeServlet",{
			'competitionid':competitionid,
			'grade':grade
		},function(data){
			console.log(data);
		      var arr=[];  
		      for (var i in data) {
		         var item = [];
		          for (var j in data[i]){
		        	  item.push(data[i][j]);
		        }
		          arr.push(item);
		      }
	        arr.unshift(dataArray);
	        console.log(arr);
			myChart.hideLoading();
			myChart.setOption({
				legend: {},
	            tooltip: {},
	            dataset: {
	                // 提供一份数据。 source对应的是个二元数组
	                source:
	                 	arr	
	            },
	            xAxis: {type: 'category',name:'专业'},
                yAxis: {name:'人数'},
                series: [
                    {type: 'bar'},
                    {type: 'bar'},
                    {type: 'bar'},
                    {type: 'bar'},
                    {type: 'bar'}
                ]
			});
			myChart.on('click',function(param){
            	//console.log(param.name);
            	//console.log(param.seriesName);
            	location.href="../record/recordinfo.html?majorname2="+param.name+"&ranks2="+param.seriesName+"&grade2="+grade+"&competitionid2="+competitionid; 
            });
		});
	}
	//搜索
	 var competitionid2 = document.getElementById("competitionid2").value;
	 var grade = document.getElementById("grade").value;
	 var active={
		  		reload:function(){
		  			var competitionid2 = document.getElementById("competitionid2").value;
		  			var grade = document.getElementById("grade").value;
		  			fuzhi5(myChart5,competitionid2,grade);
		  		    }  
		    };
			  
	  $('#search_btn').on('click', function(){
		                  var type = 'reload';
		                  active[type] ? active[type].call(this) : '';
		                });  
	  
	  //2
	function fuzhi6(myChart,competitionid,grade){
		  console.log(grade);
		$.getJSON("../CountWinerMajornameServlet",{
			'competitionid':competitionid,
			'grade':grade
		},function(data){
			console.log(data);
		      var arr=[];  
		      for (var i in data) {
		         var item = [];
		          for (var j in data[i]){
		        	  item.push(data[i][j]);
		        }
		          arr.push(item);
		      }
	        arr.unshift(dataArray2);
	        console.log(arr);
			myChart.hideLoading();
			myChart.setOption({
				legend: {},
	            tooltip: {},
	            dataset: {
	                // 提供一份数据。 source对应的是个二元数组
	                source:
	                 	arr	
	            },
	            xAxis: {type: 'category',name:'专业'},
                yAxis: {name:'人数'},
                series: [
                    {type: 'bar'},
                    {type: 'bar'},
                    {type: 'bar'},
                    {type: 'bar'},
                    {type: 'bar'}
                ]
			});
			myChart.on('click',function(param){
            	//console.log(param); 
            	//console.log(param.name);
            	//console.log(param.seriesName);
            	location.href="../record/recordinfo.html?majorname2="+param.name+"&levels2="+param.seriesName+"&grade2="+grade+"&competitionid2="+competitionid; 
            });
		});
	}
	//搜索
	 var competitionid3 = document.getElementById("competitionid3").value;
	 var grade2 = document.getElementById("grade2").value;
	 var active2={
		  		reload:function(){
		  			var competitionid3 = document.getElementById("competitionid3").value;
		  			var grade2 = document.getElementById("grade2").value;
		  			fuzhi6(myChart6,competitionid3,grade2);
		  		    }  
		    };
			  
	  $('#search_btn2').on('click', function(){
		                  var type = 'reload';
		                  active2[type] ? active2[type].call(this) : '';
		                });  
	  
	var myChart = echarts.init(document.getElementById('test_div1'));
	var myChart2 = echarts.init(document.getElementById('test_div2'));
	var myChart3 = echarts.init(document.getElementById('test_div3'));
	var myChart4 = echarts.init(document.getElementById('test_div4'));
	var myChart5 = echarts.init(document.getElementById('test_div5'));
	var myChart6 = echarts.init(document.getElementById('test_div6'));
	chushihua(myChart);
	chushihua(myChart2);
	chushihua(myChart3);
	chushihua(myChart4);
	chushihua2(myChart5);
	chushihua3(myChart6);
	fuzhi(myChart,competitionid,grade3,studentid,majorname,classname); 
	fuzhi2(myChart2,competitionid,grade3,studentid,classname); 
	fuzhi3(myChart3,competitionid,grade3,studentid,classname); 
	fuzhi4(myChart4,competitionid,grade3,studentid,majorname,classname); 
	fuzhi5(myChart5,competitionid2,grade); 
	fuzhi6(myChart6,competitionid3,grade2); 
	
	
  $(document).on('click','#icon_close',function(){
  		document.getElementById("classname").value="";
  });
  $(document).on('click','#icon_close',function(){
  		document.getElementById("majorname").value="";
  });
  $(document).on('click','#icon_close',function(){
  		document.getElementById("studentid").value="";
  });
  //监听回车
  $("#competitionid2,#grade").bind("keyup", function (e) {
      if (e.keyCode == 13) {
          var type = "reload";
          active[type] ? active[type].call(this) : '';
      }
  });
  $("#competitionid3,#grade2").bind("keyup", function (e) {
      if (e.keyCode == 13) {
          var type = "reload";
          active2[type] ? active2[type].call(this) : '';
      }
  });
  $("#competitionid,#grade3,#majorname, #classname,#studentid").bind("keyup", function (e) {
      if (e.keyCode == 13) {
          var type = "reload";
          active3[type] ? active3[type].call(this) : '';
      }
  });
/* layui.use结尾 */	
});
</script>	
	
</body>
</html>